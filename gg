-- // Feature Table //

local headshots = {

    TargetAim = {
        Enabled = false,
        Target = "None",
        AutoFire = false,
        Strafe = false,
        CSync = false,
        VisualizeStrafe = false,
        VisualizeStrafeColor = Color3.new(155, 125, 175),
        StrafeMethod = "Randomize",
        Highlight = false,
        HighlightFillColor = Color3.new(155, 125, 175),
        HighlightOutlineColor = Color3.new(129, 105, 145),
        Tracer = false,
        TracerPosition = "Mouse",
        TracerFillColor = Color3.new(155, 125, 175),
        TracerOutlineColor = Color3.new(0, 0, 0),
        LookAt = false,
        VoidResolver = false,
        AutoStomp = false,
    },

    KillAura = {
        Enabled = false,
        Keybind = false,
        Distance = 200,
        StompAura = false,
    },

    ExtraESP = {
        MaterialEnabled = false,
        Material = "Neon",
        MaterialColor = Color3.new(255, 255, 255),
        HighlightEnabled = false,
        HighlightFillColor = Color3.new(0, 0, 0),
        HighlightOutlineColor = Color3.new(0, 0, 0),
    },

    CheaterProtection = {
        Enabled = false,
    },

    HitboxExpander = {
        Enabled = false,
        Visualize = false,
        Color = Color3.new(155, 125, 175),
        OutlineColor = Color3.new(155, 125, 175),
        FillTransparency = 0.5,
        OutlineTransparency = 0.3,
        Size = 37,
    },

    Target = {
        AutoKill = false,
        AutoKillDesync = false,
        Target = nil,
    },

    Desync = {
        Enabled = false,
        Keybind = false,
        Visualize = false,
        Tranparency = 0,
        Spam = false,
        InVoid = 0.4,
        OnGround = 0.133,
        Method = "Custom",
    },

    Network = {
        Desync = false,
        UseSenderRate = false,
        SenderRate = 60,
        FakePos = false,
        RefreshRate = 20,
    },

    Speed = {
        Enabled = false,
        Keybind = false,
        Speed = 20,
    },

    Fly = {
        Enabled = false,
        Keybind = F, 
        Speed = 60,
    },

    BulletTracers = {
        Enabled = false,
        TextureID = "rbxassetid://12781852245",
        Color = Color3.new(155, 125, 175),
        Size = 0.4,
        Transparency = 0,
        TimeAlive = 3,
    },

    HitEffects = {
        HitSounds = false,
        HitSoundID = "rbxassetid://97643101798871",
        HitSoundVolume = 5,
        HitNotifications = false,
        HitNotificationsTime = 3,
    },

    AutoReload = {
        Enabled = false,
    },

    AntiStomp = {
        Enabled = false,
    },

    RapidFire = {
        Enabled = false,
    },

    AutoLoadout = {
        Enabled = false,
        Gun = "[Rifle]"
    },

    AutoArmor = {
        Enabled = false,
    },

    SelfVisuals = {
        Character = false,
        CharacterMaterial = "ForceField",
        CharacterColor = Color3.new(155, 125, 175),
        Tool = false,
        ToolMaterial = "ForceField",
        ToolColor = Color3.new(155, 125, 175),
        Aura = false,
        AuraColor = Color3.new(155, 125, 175),
        AuraTexture = "Pink Shyt",
        WalkSteps = false,
        WalkStepsRate = 0.5,
        WalkStepsSize = NumberSequence.new(0, 0.25, 0, 0.5, 1.5, 0, 1, 2, 0),
        WalkStepsColor = Color3.new(255, 255, 255),
    },

}

loadstring([[
    function LPH_NO_VIRTUALIZE(f) return f end;
]])();

if not game:IsLoaded() then
    game.Loaded:Wait()
end

-- // LocalPlayer Check Loaded

local players = game:GetService("Players")
local localPlayer = players.LocalPlayer

-- // Checking for getcustomasset

if not getcustomasset then
    getgenv().getcustomasset = function(z) return z end
end

-- // Anticheat Bypass

local t = {}

game:GetService("RunService").Heartbeat:Connect(function()
    for _, c in ipairs(getconnections(game:GetService("LogService").MessageOut)) do
        if not table.find(t, c) then
            t[#t+1] = c
            local u = pcall(getupvalues, c.Function) and getupvalues(c.Function) or {}
            if #u >= 9 and type(u[9]) == "table" and type(u[9][1]) == "function" then
                pcall(setupvalue, u[9][1], 14, function() return function(x)
                    if type(x) == "table" then for i = 1, 4 do
                        if type(x[i]) == "userdata" and x[i].Disconnect then pcall(x[i].Disconnect, x[i]) end
                    end end
                end end)
                pcall(setupvalue, u[9][1], 1, function() task.wait(200) end)
                local o = u[9][1]
                pcall(hookfunction, u[9][1], function() return {} end)
            end
        end
    end
end)

warn("[+] headshots.cc : anticheat bypassed.")

-- // UI Library //
local uis = cloneref(game:GetService("UserInputService"))
local ws = cloneref(game:GetService("Workspace"))
local http_service = cloneref(game:GetService("HttpService"))
local gui_service = cloneref(game:GetService("GuiService"))
local lighting = cloneref(game:GetService("Lighting"))
local run = cloneref(game:GetService("RunService"))
local stats = cloneref(game:GetService("Stats"))
local coregui = cloneref(game:GetService("CoreGui"))
local debris = cloneref(game:GetService("Debris"))
local tween_service = cloneref(game:GetService("TweenService"))
local sound_service = cloneref(game:GetService("SoundService"))
local starter_gui = cloneref(game:GetService("StarterGui"))
local rs = cloneref(game:GetService("ReplicatedStorage"))

local vec2 = Vector2.new
local vec3 = Vector3.new
local dim2 = UDim2.new
local dim = UDim.new 
local rect = Rect.new
local cfr = CFrame.new
local empty_cfr = cfr()
local point_object_space = empty_cfr.PointToObjectSpace
local angle = CFrame.Angles
local dim_offset = UDim2.fromOffset

local color = Color3.new
local rgb = Color3.fromRGB
local hex = Color3.fromHex
local rgbseq = ColorSequence.new
local rgbkey = ColorSequenceKeypoint.new
local numseq = NumberSequence.new
local numkey = NumberSequenceKeypoint.new

local camera = ws.CurrentCamera
local lp = players.LocalPlayer 
local mouse = lp:GetMouse() 
local gui_offset = gui_service:GetGuiInset().Y

local max = math.max 
local floor = math.floor 
local min = math.min 
local abs = math.abs 
local noise = math.noise
local rad = math.rad 
local random = math.random 
local pow = math.pow 
local sin = math.sin 
local pi = math.pi 
local tan = math.tan 
local atan2 = math.atan2 
local cos = math.cos 
local round = math.round;
local clamp = math.clamp; 
local ceil = math.ceil; 
local sqrt = math.sqrt;
local acos = math.acos; 

local insert = table.insert 
local find = table.find 
local remove = table.remove
local concat = table.concat
-- 

-- library init
local library = {
directory = "headshots",
folders = {
    "/fonts",
    "/configs",
    "/assets",
    "/images"
},
flags = {},
config_flags = {},
visible_flags = {}, 
guis = {}, 
connections = {},   
notifications = {},
playerlist_data = {
},

current_tab, 
current_element_open, 
dock_button_holder,  
font, 
keybind_list,
binds = {}, 
}

local flags = library.flags
local config_flags = library.config_flags

local themes = {
preset = {
    ["outline"] = rgb(32, 32, 38), -- 
    ["inline"] = rgb(60, 55, 75), --
    ["accent"] = rgb(155,125,175), --
    ["high_contrast"] = rgb(41, 41, 55),
    ["low_contrast"] = rgb(35, 35, 47),
    ["text"] = rgb(180, 180, 180),
    ["text_outline"] = rgb(0, 0, 0),
    ["glow"] = rgb(155, 125, 175), 
},

utility = {
    ["outline"] = {
        ["BackgroundColor3"] = {}, 	
        ["Color"] = {}, 
    },
    ["inline"] = {
        ["BackgroundColor3"] = {}, 	
    },
    ["accent"] = {
        ["BackgroundColor3"] = {}, 	
        ["TextColor3"] = {}, 
        ["ImageColor3"] = {}, 
        ["ScrollBarImageColor3"] = {} 
    },
    ["contrast"] = {
        ["Color"] = {}, 	
    },
    ["text"] = {
        ["TextColor3"] = {}, 	
    },
    ["text_outline"] = {
        ["Color"] = {}, 	
    },
    ["glow"] = {
        ["ImageColor3"] = {}, 	
    }, 
}, 

find = {
    ["Frame"] = "BackgroundColor3", 
    ["TextLabel"] = "TextColor3", 
    ["UIGradient"] = "Color",
    ["UIStroke"] = "Color",
    ["ImageLabel"] = "ImageColor3",
    ["TextButton"] = "BackgroundColor3", 
    ["ScrollingFrame"] = "ScrollBarImageColor3"
}
}

local keys = {
[Enum.KeyCode.LeftShift] = "LS",
[Enum.KeyCode.RightShift] = "RS",
[Enum.KeyCode.LeftControl] = "LC",
[Enum.KeyCode.RightControl] = "RC",
[Enum.KeyCode.Insert] = "INS",
[Enum.KeyCode.Backspace] = "BS",
[Enum.KeyCode.Return] = "Ent",
[Enum.KeyCode.LeftAlt] = "LA",
[Enum.KeyCode.RightAlt] = "RA",
[Enum.KeyCode.CapsLock] = "CAPS",
[Enum.KeyCode.One] = "1",
[Enum.KeyCode.Two] = "2",
[Enum.KeyCode.Three] = "3",
[Enum.KeyCode.Four] = "4",
[Enum.KeyCode.Five] = "5",
[Enum.KeyCode.Six] = "6",
[Enum.KeyCode.Seven] = "7",
[Enum.KeyCode.Eight] = "8",
[Enum.KeyCode.Nine] = "9",
[Enum.KeyCode.Zero] = "0",
[Enum.KeyCode.KeypadOne] = "Num1",
[Enum.KeyCode.KeypadTwo] = "Num2",
[Enum.KeyCode.KeypadThree] = "Num3",
[Enum.KeyCode.KeypadFour] = "Num4",
[Enum.KeyCode.KeypadFive] = "Num5",
[Enum.KeyCode.KeypadSix] = "Num6",
[Enum.KeyCode.KeypadSeven] = "Num7",
[Enum.KeyCode.KeypadEight] = "Num8",
[Enum.KeyCode.KeypadNine] = "Num9",
[Enum.KeyCode.KeypadZero] = "Num0",
[Enum.KeyCode.Minus] = "-",
[Enum.KeyCode.Equals] = "=",
[Enum.KeyCode.Tilde] = "~",
[Enum.KeyCode.LeftBracket] = "[",
[Enum.KeyCode.RightBracket] = "]",
[Enum.KeyCode.RightParenthesis] = ")",
[Enum.KeyCode.LeftParenthesis] = "(",
[Enum.KeyCode.Semicolon] = ",",
[Enum.KeyCode.Quote] = "'",
[Enum.KeyCode.BackSlash] = "\\",
[Enum.KeyCode.Comma] = ",",
[Enum.KeyCode.Period] = ".",
[Enum.KeyCode.Slash] = "/",
[Enum.KeyCode.Asterisk] = "*",
[Enum.KeyCode.Plus] = "+",
[Enum.KeyCode.Period] = ".",
[Enum.KeyCode.Backquote] = "`",
[Enum.UserInputType.MouseButton1] = "MB1",
[Enum.UserInputType.MouseButton2] = "MB2",
[Enum.UserInputType.MouseButton3] = "MB3",
[Enum.KeyCode.Escape] = "ESC",
[Enum.KeyCode.Space] = "SPC",
}
-- Good Target Aim ( 90%+ UNC Method )

if getnamecallmethod then
    local Meta = getrawmetatable(game)
    local backupindex = Meta.__index
    setreadonly(Meta, false)
    local Handler = game:FindService("ReplicatedStorage").MainModule
    local Module = require(Handler)
    if workspace:FindFirstChild("Vehicles") then
        Module.Ignored = {workspace:WaitForChild("Vehicles"), workspace:WaitForChild("MAP"), workspace:WaitForChild("Ignored")}
    end

    Meta.__index = function(t, k)
        if k:lower() == "hit" then
            if headshots.TargetAim.Enabled and headshots.TargetAim.CSync == false and headshots.TargetAim.Target ~= "None" and localPlayer and localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") and localPlayer.Character:FindFirstChild("Humanoid") and localPlayer.Character:FindFirstChild("Head") then
                local TargetPlayer = players:FindFirstChild(headshots.TargetAim.Target)
                if TargetPlayer.Character and TargetPlayer.Character:FindFirstChild("Head") and not TargetPlayer.Character:FindFirstChild("ForceField") then
                    if not KnockCheck(TargetPlayer) then
                        return TargetPlayer.Character.Head.CFrame
                    end
                end
            end
        end
        return backupindex(t, k)
    end
end
-- // Target Strafe
local strafeclone = CreateR6Rig()

for _, part in ipairs(strafeclone:GetDescendants()) do
    if part:IsA("Part") then
        part.CanCollide = false
        part.Material = Enum.Material.Neon
        part.Color = Color3.fromRGB(80, 120, 200)
    end
end

local pingvalue = nil
local split = nil
local ping = nil
local PredictionValue = nil

local GlobalPredictionMultiplier = 0.80

local basePredictionTable = {
    {ping = 130, value = 0.51},
    {ping = 125, value = 0.49},
    {ping = 110, value = 0.46},
    {ping = 105, value = 0.38},
    {ping = 90,  value = 0.36},
    {ping = 80,  value = 0.34},
    {ping = 70,  value = 0.31},
    {ping = 60,  value = 0.229},
    {ping = 50,  value = 0.225},
    {ping = 40,  value = 0.256}
}

local previousPositions = {}
local customVelocities = {}

game:GetService("RunService").Stepped:Connect(function()
    pingvalue = game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValueString()
    split = string.split(pingvalue, '(')
    ping = tonumber(split[1])

    for _, data in ipairs(basePredictionTable) do
        if ping < data.ping then
            PredictionValue = data.value * GlobalPredictionMultiplier
            break
        end
    end
end)

local t = 0

game:GetService("RunService").Heartbeat:Connect(function(dt)
    local TargetPlayer = players:FindFirstChild(headshots.TargetAim.Target)
    if headshots.TargetAim.Enabled and headshots.TargetAim.Strafe and headshots.TargetAim.Target ~= "None" and localPlayer and localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") and localPlayer.Character:FindFirstChild("Humanoid") and localPlayer.Character:FindFirstChild("Head") then
        local Tool = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Tool")
        if TargetPlayer and TargetPlayer.Character and TargetPlayer.Character:FindFirstChild("Head") and Tool then
            if not TargetPlayer.Character:FindFirstChild("ForceField") or Tool.Name == "[Rifle]" then
                if not KnockCheck(TargetPlayer) and localPlayer.Character and localPlayer.Character.BodyEffects and localPlayer.Character.BodyEffects.Reload.Value == false then

                    if headshots.TargetAim.VoidResolver then
                        if (TargetPlayer.Character.HumanoidRootPart.Position - Vector3.new(0, 0, 0)).Magnitude > 5000 then
                            return
                        end
                    end
    
                    local SavedPosition = localPlayer.Character.HumanoidRootPart.CFrame
                    local SpoofedPosition = nil
                    local currentPosition = TargetPlayer.Character.Head.Position
                    local lastPosition = previousPositions[TargetPlayer] or currentPosition
                    local estimatedVelocity = (currentPosition - lastPosition) / dt
                    local alpha = 0.5
    
                    customVelocities[TargetPlayer] = (customVelocities[TargetPlayer] or Vector3.zero) * alpha + estimatedVelocity * (1 - alpha)
                    previousPositions[TargetPlayer] = currentPosition
    
                    if headshots.TargetAim.StrafeMethod == "Orbit" then
                        SpoofedPosition = CFrame.lookAt(currentPosition + (customVelocities[TargetPlayer] * PredictionValue) + Vector3.new(math.cos(tick()*10)*10, 0, math.sin(tick()*10)*10), currentPosition)
                    elseif headshots.TargetAim.StrafeMethod == "Randomize" then
                        SpoofedPosition = CFrame.lookAt(currentPosition + (customVelocities[TargetPlayer] * PredictionValue) + Vector3.new(math.random(-15,15), math.random(-15,15), math.random(-15,15)), currentPosition)
                    end
    
                    localPlayer.Character.HumanoidRootPart.CFrame = SpoofedPosition
    
                    if headshots.TargetAim.VisualizeStrafe then
                        SetRigCollisionFalse(strafeclone)
                        SetRigTransparency(strafeclone, 0)
                        SetRigColor(strafeclone, headshots.TargetAim.VisualizeStrafeColor)
                        strafeclone.HumanoidRootPart.CFrame = SpoofedPosition
                    else
                        SetRigTransparency(strafeclone, 1)
                    end

                    local PredictedAimingPosition = currentPosition + (customVelocities[TargetPlayer] * PredictionValue)

                    local args = {
                        [1] = "ShootGun",
                        [2] = Tool.Handle,
                        [3] = Tool.Handle.Position,
                        [4] = PredictedAimingPosition,
                        [5] = TargetPlayer.Character.Head,
                        [6] = Vector3.new(0, 0, 0)
                    }

                    if headshots.TargetAim.AutoFire then
                        MainEvent:FireServer(unpack(args))
                    else
                        if M1Down then
                            MainEvent:FireServer(unpack(args))
                        end
                    end
    
                    if headshots.TargetAim.CSync then
                        game:GetService("RunService"):BindToRenderStep("RestoreCFrame", 199, function()
                            localPlayer.Character.HumanoidRootPart.CFrame = SavedPosition
                            game:GetService("RunService"):UnbindFromRenderStep("RestoreCFrame")
                        end)
                    end
                elseif KnockCheck(TargetPlayer) and headshots.TargetAim.AutoStomp and localPlayer.Character.BodyEffects.Reload.Value == false then
                    local bodyEffects = TargetPlayer.Character:FindFirstChild("BodyEffects")
                    local isDead = bodyEffects and bodyEffects:FindFirstChild("SDeath") and bodyEffects.SDeath.Value
                    if isDead == false then
                        SavedPosition = game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.CFrame
        
                        game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(TargetPlayer.Character.UpperTorso.Position + Vector3.new(0, 3, 0))

                        if headshots.TargetAim.VisualizeStrafe then
                            SetRigCollisionFalse(strafeclone)
                            SetRigTransparency(strafeclone, 0)
                            SetRigColor(strafeclone, headshots.TargetAim.VisualizeStrafeColor)
                            strafeclone.HumanoidRootPart.CFrame = game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.CFrame
                        else
                            SetRigTransparency(strafeclone, 1)
                        end
        
                        if headshots.HitEffects.HitNotifications then
                            if tick() - t >= 3 then
                                t = tick()
                                library:notification({ text = "headshots.cc - Attempted to Stomp Target: " .. TargetPlayer.Name, time = headshots.HitEffects.HitNotificationsTime })
                            end
                        end
            
                        MainEvent:FireServer("Stomp")
                    
                        game:GetService("RunService"):BindToRenderStep("RestoreCFrame", 199, function()
                            game:GetService("Players").LocalPlayer.Character.HumanoidRootPart.CFrame = SavedPosition
                            game:GetService("RunService"):UnbindFromRenderStep("RestoreCFrame")
                        end)
                    else
                        SetRigTransparency(strafeclone, 1)
                    end
                else
                    SetRigTransparency(strafeclone, 1)
                end
            else
                SetRigTransparency(strafeclone, 1)
            end
        else
            SetRigTransparency(strafeclone, 1)
        end
    else
        SetRigTransparency(strafeclone, 1)
    end
end)

local tracerOutline = Drawing.new("Line")
tracerOutline.Visible = false
tracerOutline.Color = headshots.TargetAim.TracerOutlineColor
tracerOutline.Thickness = 4

local tracer = Drawing.new("Line")
tracer.Visible = false
tracer.Color = headshots.TargetAim.TracerFillColor
tracer.Thickness = 2

game:GetService("RunService").Heartbeat:Connect(function(dt)
-- Target Aim Logic
    if headshots.TargetAim.Enabled and headshots.TargetAim.Strafe and headshots.TargetAim.Target ~= "None" and localPlayer and localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") and localPlayer.Character:FindFirstChild("Humanoid") and localPlayer.Character:FindFirstChild("Head") then
        local TargetPlayer = players:FindFirstChild(headshots.TargetAim.Target)
        local Tool = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Tool")
        if TargetPlayer and TargetPlayer.Character and TargetPlayer.Character:FindFirstChild("Head") and Tool then
            if not TargetPlayer.Character:FindFirstChild("ForceField") or Tool.Name == "[Rifle]" then
                local bodyEffects = TargetPlayer.Character:FindFirstChild("BodyEffects")
                local isDead = bodyEffects and bodyEffects:FindFirstChild("SDeath") and bodyEffects.SDeath.Value   
                if ((not KnockCheck(TargetPlayer)) or (headshots.TargetAim.AutoStomp and isDead == false)) and localPlayer.Character and localPlayer.Character:FindFirstChild("BodyEffects") and localPlayer.Character.BodyEffects:FindFirstChild("Reload") and localPlayer.Character.BodyEffects.Reload.Value == false then
                    if headshots.TargetAim.VoidResolver then
                        if (TargetPlayer.Character.HumanoidRootPart.Position - Vector3.new(0, 0, 0)).Magnitude > 5000 then
                            return
                        end
                    end
                    TargetAimActive = true
                end
            end
        end
    end
-- Fly
    if headshots.Fly.Enabled and headshots.Fly.Keybind then
        if localPlayer and localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local move_direction = localPlayer.Character.Humanoid.MoveDirection;
            local hrp = localPlayer.Character.HumanoidRootPart;
            local add = Vector3.new(0, (game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.Space) and headshots.Fly.Speed /  8 or game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.LeftShift) and -headshots.Fly.Speed / 8) or 0, 0);
            hrp.CFrame = hrp.CFrame + (move_direction * dt) * headshots.Fly.Speed * 10;
            hrp.CFrame = hrp.CFrame + add;
            hrp.Velocity = (hrp.Velocity * Vector3.new(1, 0, 1)) + Vector3.new(0, 1.9, 0);
        end
    end
end)
headshots.TargetAim.Keybind = Enum.KeyCode.E
headshots.Fly.Keybind = Enum.KeyCode.F
headshots.TargetAim.TracerKeybind = Enum.KeyCode.T
headshots.TargetAim.HighlightKeybind = Enum.KeyCode.H
headshots.TargetAim.StrafeKeybind = Enum.KeyCode.Z
